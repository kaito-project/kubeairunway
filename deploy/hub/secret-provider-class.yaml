# SecretProviderClass for Azure Key Vault integration.
# Mounts cluster kubeconfig files from Key Vault into the hub pod
# via the Secrets Store CSI Driver.
#
# Prerequisites:
#   1. Secrets Store CSI Driver installed in the cluster
#   2. Azure Key Vault with cluster kubeconfigs stored as secrets
#   3. Managed identity with read access to the Key Vault
#
# CHANGE_ME: Replace the ${...} placeholders below with your values.

apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: kubefoundry-hub-credentials
  namespace: kubefoundry-system
  labels:
    app.kubernetes.io/name: kubefoundry
    app.kubernetes.io/component: credentials
spec:
  provider: azure
  parameters:
    usePodIdentity: "false"
    useVMManagedIdentity: "true"
    # CHANGE_ME: client ID of the user-assigned managed identity
    userAssignedIdentityID: "${AZURE_USER_ASSIGNED_IDENTITY_ID}"
    # CHANGE_ME: name of your Azure Key Vault
    keyvaultName: "${AZURE_KEYVAULT_NAME}"
    objects: |
      array:
        - |
          objectName: cluster-a-kubeconfig
          objectType: secret
        - |
          objectName: cluster-b-kubeconfig
          objectType: secret
    # CHANGE_ME: your Azure tenant ID
    tenantId: "${AZURE_TENANT_ID}"
